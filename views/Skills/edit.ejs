<%- include('../partials/header') %>

<% if (user) { %>

    <dialog data-modal id="editSkillModal" class="edit-skill-modal edit-modal">
        <h1 class="step-title">Edit Your <b><%= skill.skillName %></b> Skill</h1>
        <form action="/skills/<%= skill._id %>?_method=PUT" method="POST">
            
            <div class="form-group">
                <label for="skill-name">Skill Name</label>
                    <input type="text" name="skillName" id="skill-name" value="<%= skill.skillName %>" required>
            </div>
            <div class="form-group">
                <label for="skill-category">Category</label>
                    <input type="text" name="category" id="skill-category" value="<%= skill.category %>">
            </div>
            <div class="form-group">
                <label for="skill-description">Description</label>
                    <input type="text" name="description" id="skill-description" value="<%= skill.description %>">
            </div>
            <div class="form-group">
                <label for="skill-priority">Priority</label> 
                <select name="priority" id="skill-priority">
                    <option value="low" <%= skill.priority === 'low' ? 'selected' : '' %>>Low</option>
                    <option value="medium" <%= skill.priority === 'medium' ? 'selected' : '' %>>Medium</option>
                    <option value="high" <%= skill.priority === 'high' ? 'selected' : '' %>>High</option>
                </select>
            </div> 
            <div class="form-group">
                <label for="skillStatus">Status</label>
                <select name="status" id="skillStatus">
                    <option value="In Progress" <%= skill.status === 'In Progress' ? 'selected' : '' %>>In Progress</option>
                    <option value="Completed" <%= skill.status === 'Completed' ? 'selected' : '' %>>Completed</option>
                </select>
            </div>

            <div class="form-buttons">
                <button type="button" onclick="goBack()">Cancel</button>
                <button type="submit" name="action" value="submitSkill">Submit</button>
            </div>

        </form>
        <form action="/skills/<%= skill._id %>?_method=DELETE" method="POST">
            <button type="submit" onclick="return confirm('GOALS and DAILY TASKS associated with this skill will also be deleted.')">Delete Skill</button>
        </form>
    </dialog>

    <script>
        const checkbox = document.getElementById('skillStatus');

        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.querySelector('[data-modal]')
            modal.showModal()
        })
    
        const modal = document.querySelector('[data-modal]')
    
        function goBack() {
            window.history.back()
        }
    
        // modal.addEventListener('click', e => {
        //     const dialogDimensions = modal.getBoundingClientRect();
        //     if (
        //         e.clientX < dialogDimensions.left ||
        //         e.clientX > dialogDimensions.right ||
        //         e.clientY < dialogDimensions.top ||
        //         e.clientY > dialogDimensions.bottom
        //     ) {
        //         goBack()
        //     }
        // })
    
        document.addEventListener('DOMContentLoaded', function () {
            // Add an event listener to the submit button
            const submitButton = document.querySelector('[name="action"][value="submitSkill"]');
            if (submitButton) {
                submitButton.addEventListener('click', function (event) {
                    // Check if the selected status is "Completed"
                    const statusSelect = document.getElementById('skillStatus');
                    if (statusSelect.value === 'Completed') {
                        // Show a confirmation dialog
                        const isConfirmed = confirm('You are only <%= skill.percentCompleted %>% completed with this skill.\n Are you sure you would like to mark it as completed?');
                        
                        // If the user cancels, prevent the form submission
                        if (!isConfirmed) {
                            event.preventDefault();
                        }
                    }
                });
            }
        });
    </script>

<% } %>

<%- include('../partials/footer') %>