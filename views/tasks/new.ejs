<%- include('../partials/header') %>

<% if (user) { %>

    <br><br>

    <h1><%= title %></h1>

    <form action="/tasks" method="POST" id="taskForm">
        <label>
            <span>Type: </span>
            <select name="type" required>
                <option value="dailyTask">Daily Task</option>
            </select>
        </label><br>
        <label>
            <span>Skill: </span>
            <select name="skill" id="skillSelect" required>
                <option value="" disabled selected>Select the related skill</option>
                <% skills.forEach(function(skill) { %>
                    <option value="<%= skill._id %>"><%= skill.skillName %></option>
                <% }) %>
            </select>
        </label><br>
        <label>
            <span>Goal: </span>
            <select name="goal" id="goalSelect" required disabled>
                <option value="" disabled selected>Select the related goal</option>
                <% goals.forEach(function(goal) { %>
                    <option value="<%= goal._id %>" data-skill="<%= goal.skill %>"><%= goal.name %></option>
                <% }) %>
            </select>
        </label><br>
        
        <label>
            <span>Name: </span>
            <input type="text" name="name">
        </label><br>
        <label>
            <span>Description: </span>
            <input type="text" name="description">
        </label><br>
        <label>
            <span>Priority: </span>
            <select name="priority">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
            </select>
        </label><br>
        
        <br><br>

        <button type="submit">Add Daily Task</button>
    </form>

    <script>
        document.getElementById('skillSelect').addEventListener('change', function() {
            let selectedSkill = this.value
            let goalSelect = document.getElementById('goalSelect')
            goalSelect.disabled = !selectedSkill
            if (selectedSkill) {
                let goals = document.querySelectorAll('#goalSelect option')
                goals.forEach(function(goal) {
                    goal.disabled = (goal.value && goal.getAttribute('data-skill') !== selectedSkill)
                })
                goalSelect.value = ''
            }
        })
    </script>
    
<% } %>

<%- include('../partials/footer') %>
